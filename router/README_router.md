# Маршрутизация запросов (Router)

## Назначение
Папка `/router` отвечает за приём входящих HTTP-запросов (`doGet`, `doPost`), проверку прав доступа, определение версии API и передачу запроса в нужный файл обработки.

---

## Состав папки
- `router.gs` — главный файл. Содержит функции `doGet(e)` и `doPost(e)`.
- `handle.get.v1.gs` — обработка GET-запросов для версии API 1.
- `handle.get.v2.gs` — обработка GET-запросов для версии API 2.
- `handle.post.v1.gs` — обработка POST-запросов для версии API 1.

---

## Как обрабатывается запрос
1. Приходит запрос в `doGet` или `doPost`.
2. Определяется параметр `action` — какое действие нужно выполнить.
3. Определяется, кто отправил запрос (`req-initiator`) — для логов.
4. Проверяется токен доступа (в параметрах запроса или в заголовке).
5. Определяется версия API по параметру `v`.
6. Ищется соответствующая константа действия в `/shared`.
7. Вызывается нужная функция обработки в зависимости от версии API.

---

## Как добавить новое действие
1. Добавить внутреннее название в `GetActions` или `PostActions` в папке `/shared`.
2. Добавить публичное название в `PublicGetActions` или `PublicPostActions`.
3. Создать функцию обработки в подходящем файле, например `handle.get.v1.gs`.
4. Если нужно — создать отдельную реализацию в папке нужного раздела (например, `/geo`).
5. Проверить работу через Postman или curl.

---

## Пример запроса через curl
```bash
curl --location 'https://script.google.com/macros/s/DEPLOY_ID/exec?action=HEALTHCHECK_V1&v=1&token=ВАШ_ТОКЕН' --header 'Content-Type: application/json' --request GET
```