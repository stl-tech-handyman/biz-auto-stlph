# Build stage
FROM golang:1.24 AS builder

WORKDIR /app

# Copy go mod files
COPY go/go.mod go/go.sum ./
RUN go mod download

# Copy source code
COPY go/ ./

# Build email API
RUN CGO_ENABLED=0 GOOS=linux go build -gcflags="all=-N -l" -o email-api ./cmd/email-api

# Runtime stage (dev uses full image for debugging)
FROM golang:1.24

WORKDIR /app

# Copy binary
COPY --from=builder /app/email-api .

# Copy config if needed (templates may not exist)
COPY --from=builder /app/config ./config

# Expose port
EXPOSE 8080

# Run email API
CMD ["./email-api"]

